<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pastelaria - Pedidos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #ecc77779;
}

/* HEADER */
#header {
    position: fixed;
    top: 0;
    width: 100%;
    background: white;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 10px 15px;
    z-index: 1000;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

#logo {
    display: flex;
    gap: 10px;
    align-items: center;
}

#logo img {
    height: 40px;
}

#logo span {
    font-weight: bold;
    font-size: 18px;
}

/* BOTÃO FLUTUANTE DO CARRINHO */
#carrinho-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #ff9800;
    border: none;
    color: white;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    font-size: 24px;
    z-index: 999;
    box-shadow: 0 4px 12px rgba(255, 152, 0, 0.4);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

#carrinho-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(255, 152, 0, 0.6);
}

#carrinho-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #d32f2f;
    color: white;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* CATEGORIAS */
.categorias-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 90px 15px 20px;
    max-width: 500px;
    margin: auto;
}

.categoria-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}

.categoria-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.categoria-card .emoji {
    font-size: 32px;
    margin-bottom: 10px;
}

.categoria-card h3 {
    font-size: 16px;
    color: #333;
}

/* VISTA DE PRODUTOS */
#produtos-view {
    display: none;
    padding: 90px 15px 150px;
    max-width: 500px;
    margin: auto;
}

.voltar-btn {
    background: #f8df00;
    border: none;
    color: rgb(0, 0, 0);
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 20px;
    font-weight: bold;
}

.produtos-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.produto-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.produto-nome {
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
}

.produto-descricao {
    font-size: 13px;
    color: #666;
    margin-bottom: 12px;
    font-style: italic;
}

.tamanho-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.tamanho-row:last-child {
    border-bottom: none;
}

.tamanho-info {
    flex: 1;
}

.tamanho-nome {
    font-weight: 600;
    color: #333;
}

.tamanho-preco {
    color: #ff9800;
    font-weight: bold;
    font-size: 14px;
}

.controles {
    display: flex;
    gap: 8px;
    align-items: center;
}

.controles button {
    background: #ff9800;
    border: none;
    color: white;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
}

.controles span {
    min-width: 30px;
    text-align: center;
    font-weight: bold;
}

/* CARRINHO */
#carrinho-view {
    display: none;
    padding: 90px 15px 150px;
    max-width: 500px;
    margin: auto;
}

.carrinho-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.item-info {
    flex: 1;
}

.item-nome {
    font-weight: bold;
    color: #333;
}

.item-preco {
    color: #ff9800;
    font-weight: bold;
}

.item-qtd {
    color: #999;
    font-size: 13px;
}

.item-remover {
    background: #d32f2f;
    border: none;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
}

.carrinho-vazio {
    text-align: center;
    padding: 40px 20px;
    color: #999;
}

/* FORMULÁRIO */
.form-section {
    background: white;
    padding: 15px;
    margin-bottom: 12px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.form-section h3 {
    margin-bottom: 12px;
    color: #333;
}

input, select {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 14px;
}

input:last-child, select:last-child {
    margin-bottom: 0;
}

.endereco-hidden {
    display: none;
}

/* RESUMO */
.resumo {
    background: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 12px;
}

.resumo-linha {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.resumo-linha:last-child {
    border-bottom: none;
    padding-top: 10px;
    padding-bottom: 0;
}

.resumo-label {
    color: #666;
}

.resumo-valor {
    font-weight: bold;
    color: #333;
}

.resumo-total {
    font-size: 18px;
    color: #ff9800;
}

/* BOTÕES */
.btn-finalizar {
    background: green;
    border: none;
    color: white;
    padding: 15px;
    border-radius: 5px;
    width: 100%;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin-bottom: 20px;
}

.btn-finalizar:hover {
    background: #2e7d32;
}

.btn-finalizar:disabled {
    background: #ccc;
    cursor: not-allowed;
}

/* MODAL */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 2000;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 25px;
    border-radius: 10px;
    max-width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.modal-titulo {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 15px;
    color: #333;
}

.modal-botoes {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.modal-botoes button {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
}

.btn-voltar {
    background: #999;
    color: white;
}

.btn-confirmar {
    background: green;
    color: white;
}

.pix-aviso {
    background: #fff3cd;
    border: 1px solid #ffc107;
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
    color: #856404;
}

</style>
</head>

<body>

<!-- HEADER -->
<div id="header">
  <div id="logo">
    <img src="logo.jpeg" alt="Logo O Pastelão">
    <span>O PASTELÃO</span>
  </div>
</div>

<!-- BOTÃO FLUTUANTE DO CARRINHO -->
<button id="carrinho-btn" onclick="abrirCarrinho()">
  <img src="carrinho.png" alt="Carrinho" style="height: 30px; width: 30px;">
  <span id="carrinho-badge" style="display: none;">0</span>
</button>

<!-- VISTA DE CATEGORIAS -->
<div id="categorias-view" class="categorias-container">
  <div class="categoria-card" onclick="abrirCategoria('tradicionais')">
    <div class="emoji"><img src="tradicional.png" alt="Tradicionais" style="height: 60px; width: 60px;"></div>
    <h3>Pastéis Tradicionais</h3>
    <p style="font-size: 12px; color: #666; margin-top: 5px;">4 itens</p>
  </div>
  <div class="categoria-card" onclick="abrirCategoria('duplos')">
    <div class="emoji"><img src="duplo.png" alt="Duplos" style="height: 60px; width: 60px;"></div>
    <h3>Pastéis Duplos</h3>
    <p style="font-size: 12px; color: #666; margin-top: 5px;">19 itens</p>
  </div>
  <div class="categoria-card" onclick="abrirCategoria('triplos')">
    <div class="emoji"><img src="triplo.png" alt="Triplos" style="height: 60px; width: 60px;"></div>
    <h3>Pastéis Triplos</h3>
    <p style="font-size: 12px; color: #666; margin-top: 5px;">17 itens</p>
  </div>
  <div class="categoria-card" onclick="abrirCategoria('especiais')">
    <div class="emoji"><img src="especial.png" alt="Especiais" style="height: 60px; width: 60px;"></div>
    <h3>Especiais</h3>
    <p style="font-size: 12px; color: #666; margin-top: 5px;">8 itens</p>
  </div>
  <div class="categoria-card" onclick="abrirCategoria('doces')">
       <div class="emoji"><img src="doces.png" alt="Especiais" style="height: 60px; width: 60px;"></div>
    <h3>Doces</h3>
    <p style="font-size: 12px; color: #666; margin-top: 5px;">4 itens</p>
  </div>
  <div class="categoria-card" onclick="abrirCategoria('bebidas')">
    <div class="emoji"><img src="bebidas.png" alt="Bebidas" style="height: 60px; width: 60px;"></div>
    <h3>Bebidas</h3>
    <p style="font-size: 12px; color: #666; margin-top: 5px;">2 itens</p>
  </div>
</div>

<!-- VISTA DE PRODUTOS -->
<div id="produtos-view">
  <button class="voltar-btn" onclick="voltarCategorias()">← Voltar</button>
  <h2 id="titulo-categoria"></h2>
  <div id="produtos-lista" class="produtos-grid"></div>
</div>

<!-- VISTA DE CARRINHO -->
<div id="carrinho-view">
  <button class="voltar-btn" onclick="voltarCarrinho()">← Voltar</button>
  <h2><img src="carrinho.png" alt="Carrinho" style="height: 25px; width: 25px; vertical-align: middle; margin-right: 8px;"> Meu Carrinho</h2>
  
  <div id="itens-carrinho"></div>
  
  <div id="form-pedido">
    <div class="form-section">
      <h3><img src="nome.png" alt="Identificação" style="height: 20px; width: 20px; display: inline; vertical-align: middle; margin-right: 8px;"> Identificação</h3>
      <input type="text" id="nomeCliente" placeholder="Seu nome *" required>
    </div>

    <div class="form-section">
      <h3><img src="entrega.png" alt="Entrega" style="height: 20px; width: 20px; display: inline; vertical-align: middle; margin-right: 8px;"> Tipo de Pedido</h3>
      <select id="tipoPedido" onchange="atualizarTotal()">
        <option value="retirada">Retirada no Local</option>
        <option value="entrega">Entrega</option>
      </select>
      
      <div id="endereco-campos" class="endereco-hidden">
        <input type="text" id="rua" placeholder="Rua *">
        <input type="text" id="numeroCasa" placeholder="Número *">
        <input type="text" id="bairro" placeholder="Bairro *">
      </div>
    </div>

    <div class="form-section">
      <h3><img src="cartao.png" alt="Pagamento" style="height: 20px; width: 20px; display: inline; vertical-align: middle; margin-right: 8px;"> Forma de Pagamento</h3>
      <select id="pagamento">
        <option value="pix">PIX</option>
        <option value="dinheiro">Dinheiro</option>
        <option value="cartao">Cartão</option>
      </select>
    </div>

    <div class="resumo">
      <div class="resumo-linha">
        <span class="resumo-label">Subtotal:</span>
        <span class="resumo-valor" id="subtotal">R$ 0,00</span>
      </div>
      <div id="linha-taxa" class="resumo-linha" style="display: none;">
        <span class="resumo-label">Taxa de Entrega:</span>
        <span class="resumo-valor">R$ 3,00</span>
      </div>
      <div class="resumo-linha">
        <span class="resumo-label resumo-total">Total:</span>
        <span class="resumo-valor resumo-total" id="total">R$ 0,00</span>
      </div>
    </div>

    <button class="btn-finalizar" id="finalizarBtn" onclick="abrirConfirmacao()">
      Finalizar Pedido
    </button>
  </div>
</div>

<!-- MODAL DE CONFIRMAÇÃO -->
<div id="modal-confirmacao" class="modal">
  <div class="modal-content">
    <div class="modal-titulo"><img src="carrinho.png" alt="Confirmar" style="height: 20px; width: 20px; display: inline; vertical-align: middle; margin-right: 8px;"> Confirmar Pedido</div>
    <div id="resumo-pedido"></div>
    <div class="modal-botoes">
      <button class="btn-voltar" onclick="fecharModal()">Voltar</button>
      <button class="btn-confirmar" onclick="enviarWhatsApp()">Confirmar</button>
    </div>
  </div>
</div>

<!-- MODAL DE PIX -->
<div id="modal-pix" class="modal">
  <div class="modal-content">
    <div class="modal-titulo"><img src="pix.png" alt="PIX" style="height: 20px; width: 20px; display: inline; vertical-align: middle; margin-right: 8px;"> Pagamento via PIX</div>
    <div class="pix-aviso">
      Para que seu pedido seja anotado e preparado, é obrigatório enviar o <strong>comprovante de pagamento</strong> no WhatsApp da loja após confirmar.
    </div>
    <div class="modal-botoes">
      <button class="btn-voltar" onclick="fecharModalPix()">Voltar</button>
      <button class="btn-confirmar" onclick="confirmarPix()">Entendi, Enviar</button>
    </div>
  </div>
</div>

<script>
// DADOS DOS PRODUTOS
const produtos = {
  tradicionais: [
    { nome: 'Carne', tamanhos: [{label: 'P', preco: 12}, {label: 'M', preco: 16}, {label: 'G', preco: 33}] },
    { nome: 'Frango', tamanhos: [{label: 'P', preco: 12}, {label: 'M', preco: 16}, {label: 'G', preco: 33}] },
    { nome: 'Queijo', tamanhos: [{label: 'P', preco: 12}, {label: 'M', preco: 18}, {label: 'G', preco: 33}] },
    { nome: 'Presunto', tamanhos: [{label: 'P', preco: 12}, {label: 'M', preco: 16}, {label: 'G', preco: 33}] },
  ],
  duplos: [
    { nome: 'Pizza', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Carne c/ Queijo', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Carne c/ Frango', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Carne c/ Palmito', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Carne c/ Milho', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Carne c/ Banana', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Carne c/ Catupiry', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Carne c/ Cream Cheese', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 37}] },
    { nome: 'Frango c/ Queijo', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Frango c/ Palmito', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Frango c/ Banana', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Frango c/ Catupiry', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Queijo c/ Banana', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Queijo c/ Palmito', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Queijo c/ Milho', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Queijo c/ Catupiry', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Queijo c/ Cream Cheese', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Milho c/ Catupiry', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Milho c/ Cream Cheese', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 37}] },
  ],
  triplos: [
    { nome: 'Carne, Frango e Queijo', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Carne, Frango e Catupiry', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Carne, Frango e Cream Cheese', tamanhos: [{label: 'P', preco: 18}, {label: 'M', preco: 22}, {label: 'G', preco: 38}] },
    { nome: 'Carne, Frango e Palmito', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Carne, Frango e Banana', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Carne, Milho e Catupiry', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Carne, Milho e Cream Cheese', tamanhos: [{label: 'P', preco: 18}, {label: 'M', preco: 22}, {label: 'G', preco: 38}] },
    { nome: 'Carne, Milho e Queijo', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Frango, Queijo e Banana', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Frango, Palmito e Catupiry', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Frango, Palmito e Cream Cheese', tamanhos: [{label: 'P', preco: 18}, {label: 'M', preco: 22}, {label: 'G', preco: 38}] },
    { nome: 'Frango, Milho e Catupiry', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Frango, Milho e Cream Cheese', tamanhos: [{label: 'P', preco: 18}, {label: 'M', preco: 22}, {label: 'G', preco: 38}] },
    { nome: 'Frango, Queijo e Milho', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Frango, Queijo e Palmito', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'Frango, Queijo e Catupiry', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
    { nome: 'pizza c/ frango', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 36}] },
  ],
  especiais: [
    { nome: 'Carne Especial', descricao: 'Carne, Presunto, Queijo e Ovo', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Torta Capixaba', descricao: 'Bacalhau e Palmito', tamanhos: [{label: 'P', preco: 16}, {label: 'M', preco: 20}, {label: 'G', preco: 37}] },
    { nome: 'Portuguesa', descricao: 'Ovo, Presunto, Milho, Queijo e Azeitona', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Moda da Casa', descricao: 'Azeitona, Queijo, Milho, Carne Seca e Banana', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Nordestino', descricao: 'Carne Seca, Queijo, Milho e Catupiry', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Queijo e Cia', descricao: 'Queijo, Milho, Tomate e Orégano', tamanhos: [{label: 'P', preco: 12}, {label: 'M', preco: 16}, {label: 'G', preco: 33}] },
    { nome: 'Atum Especial', descricao: 'Atum, Milho, Molho Especial e Palmito', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
    { nome: 'Atum à Moda', descricao: 'Atum, Presunto, Cebola, Tomate e Catupiry', tamanhos: [{label: 'P', preco: 14}, {label: 'M', preco: 18}, {label: 'G', preco: 35}] },
  ],
  doces: [
    { nome: 'Doce de Leite', tamanhos: [{label: 'P', preco: 8}, {label: 'M', preco: 12}, {label: 'G', preco: 20}] },
    { nome: 'Banana com Canela', tamanhos: [{label: 'P', preco: 8}, {label: 'M', preco: 12}, {label: 'G', preco: 20}] },
    { nome: 'Chocolate', tamanhos: [{label: 'P', preco: 8}, {label: 'M', preco: 12}, {label: 'G', preco: 20}] },
    { nome: 'Goiabada', tamanhos: [{label: 'P', preco: 8}, {label: 'M', preco: 12}, {label: 'G', preco: 20}] },
  ],
  bebidas: [
    { nome: 'Caldo de Cana', tamanhos: [{label: 'Copo 500ml', preco: 10}, {label: '1L (Jarra)', preco: 19}] },
    { nome: 'Suco Natural', tamanhos: [{label: 'Copo 500ml', preco: 10}, {label: '1L (Jarra)', preco: 19}] },
  ]
};

const categoriasNomes = {
  tradicionais: 'Pastéis Tradicionais',
  duplos: 'Pastéis Duplos',
  triplos: 'Pastéis Triplos',
  especiais: 'Especiais',
  doces: 'Doces',
  bebidas: 'Bebidas'
};

let carrinho = [];
const taxaEntrega = 3;

// NAVEGAÇÃO
function abrirCategoria(categoria) {
  document.getElementById('categorias-view').style.display = 'none';
  document.getElementById('carrinho-view').style.display = 'none';
  document.getElementById('produtos-view').style.display = 'block';
  
  document.getElementById('titulo-categoria').textContent = categoriasNomes[categoria];
  renderizarProdutos(categoria);
}

function voltarCategorias() {
  document.getElementById('produtos-view').style.display = 'none';
  document.getElementById('carrinho-view').style.display = 'none';
  document.getElementById('categorias-view').style.display = 'grid';
}

function abrirCarrinho() {
  document.getElementById('categorias-view').style.display = 'none';
  document.getElementById('produtos-view').style.display = 'none';
  document.getElementById('carrinho-view').style.display = 'block';
  
  renderizarCarrinho();
  atualizarTotal();
}

function voltarCarrinho() {
  document.getElementById('carrinho-view').style.display = 'none';
  document.getElementById('categorias-view').style.display = 'grid';
}

// RENDERIZAR PRODUTOS
function renderizarProdutos(categoria) {
  const lista = document.getElementById('produtos-lista');
  lista.innerHTML = '';
  
  produtos[categoria].forEach((produto, idx) => {
    const div = document.createElement('div');
    div.className = 'produto-item';
    
    let tamanhos = '';
    produto.tamanhos.forEach((tam, tIdx) => {
      const qtdCarrinho = carrinho.find(i => i.nome === produto.nome && i.tamanho === tam.label)?.qtd || 0;
      tamanhos += `
        <div class="tamanho-row">
          <div class="tamanho-info">
            <div class="tamanho-nome">${tam.label}</div>
            <div class="tamanho-preco">R$ ${tam.preco.toFixed(2)}</div>
          </div>
          <div class="controles">
            <button onclick="adicionarAoCarrinho('${produto.nome}', '${tam.label}', ${tam.preco}); renderizarProdutos('${categoria}')">+</button>
            <span id="qtd-${categoria}-${idx}-${tIdx}">${qtdCarrinho}</span>
            <button onclick="removerDoCarrinho('${produto.nome}', '${tam.label}'); renderizarProdutos('${categoria}')">-</button>
          </div>
        </div>
      `;
    });
    
    const descricao = produto.descricao ? `<div class="produto-descricao">${produto.descricao}</div>` : '';
    
    div.innerHTML = `
      <div class="produto-nome">${produto.nome}</div>
      ${descricao}
      ${tamanhos}
    `;
    lista.appendChild(div);
  });
}

// CARRINHO
function adicionarAoCarrinho(nome, tamanho, preco) {
  const item = carrinho.find(i => i.nome === nome && i.tamanho === tamanho);
  if (item) {
    item.qtd++;
  } else {
    carrinho.push({ nome, tamanho, preco, qtd: 1 });
  }
  atualizarBadgeCarrinho();
}

function removerDoCarrinho(nome, tamanho) {
  const idx = carrinho.findIndex(i => i.nome === nome && i.tamanho === tamanho);
  if (idx !== -1) {
    if (carrinho[idx].qtd > 1) {
      carrinho[idx].qtd--;
    } else {
      carrinho.splice(idx, 1);
    }
  }
  atualizarBadgeCarrinho();
}

function atualizarBadgeCarrinho() {
  const total = carrinho.reduce((sum, item) => sum + item.qtd, 0);
  const badge = document.getElementById('carrinho-badge');
  if (total > 0) {
    badge.textContent = total;
    badge.style.display = 'flex';
  } else {
    badge.style.display = 'none';
  }
}

function renderizarCarrinho() {
  const container = document.getElementById('itens-carrinho');
  
  if (carrinho.length === 0) {
    container.innerHTML = '<div class="carrinho-vazio">Seu carrinho está vazio <img src="carrinho.png" alt="Carrinho" style="height: 20px; width: 20px; vertical-align: middle;"></div>';
    document.getElementById('form-pedido').style.display = 'none';
    return;
  }
  
  document.getElementById('form-pedido').style.display = 'block';
  
  container.innerHTML = '';
  carrinho.forEach((item) => {
    const div = document.createElement('div');
    div.className = 'carrinho-item';
    div.innerHTML = `
      <div class="item-info">
        <div class="item-nome">${item.nome} (${item.tamanho})</div>
        <div class="item-qtd">Quantidade: ${item.qtd}</div>
        <div class="item-preco">R$ ${(item.qtd * item.preco).toFixed(2)}</div>
      </div>
      <button class="item-remover" onclick="removerDoCarrinho('${item.nome}', '${item.tamanho}'); renderizarCarrinho(); atualizarBadgeCarrinho();">Remover</button>
    `;
    container.appendChild(div);
  });
}

function atualizarTotal() {
  const subtotal = carrinho.reduce((sum, item) => sum + (item.qtd * item.preco), 0);
  const tipo = document.getElementById('tipoPedido').value;
  const enderecoDiv = document.getElementById('endereco-campos');
  const linhasTaxa = document.getElementById('linha-taxa');
  
  if (tipo === 'entrega') {
    enderecoDiv.classList.remove('endereco-hidden');
    linhasTaxa.style.display = 'flex';
    var total = subtotal + taxaEntrega;
  } else {
    enderecoDiv.classList.add('endereco-hidden');
    linhasTaxa.style.display = 'none';
    var total = subtotal;
  }
  
  document.getElementById('subtotal').textContent = `R$ ${subtotal.toFixed(2)}`;
  document.getElementById('total').textContent = `R$ ${total.toFixed(2)}`;
}

// MODAL
function abrirConfirmacao() {
  const nome = document.getElementById('nomeCliente').value.trim();
  
  if (!nome) {
    alert('Por favor, digite seu nome');
    return;
  }
  
  if (document.getElementById('tipoPedido').value === 'entrega') {
    const rua = document.getElementById('rua').value.trim();
    const numero = document.getElementById('numeroCasa').value.trim();
    const bairro = document.getElementById('bairro').value.trim();
    if (!rua || !numero || !bairro) {
      alert('Por favor, preencha todos os dados de endereço');
      return;
    }
  }
  
  let resumo = `<div style="margin-bottom: 15px;">`;
  resumo += `<p><strong><img src="logo.jpeg" alt="Cliente" style="height: 16px; width: 16px; display: inline; vertical-align: middle; margin-right: 4px;"> Cliente:</strong> ${nome}</p>`;
  
  let subtotal = 0;
  let totalItens = 0;
  carrinho.forEach(item => {
    const valor = item.qtd * item.preco;
    subtotal += valor;
    totalItens += item.qtd;
    resumo += `<p>${item.nome} (${item.tamanho}) x${item.qtd} - R$ ${valor.toFixed(2)}</p>`;
  });
  
  resumo += `<p style="margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px;"><strong>Total de Itens:</strong> ${totalItens}</p>`;
  
  const tipo = document.getElementById('tipoPedido').value;
  const pagamento = document.getElementById('pagamento').value;
  
  resumo += `<p><strong><img src="entrega.png" alt="Tipo" style="height: 16px; width: 16px; display: inline; vertical-align: middle; margin-right: 4px;"> Tipo:</strong> ${tipo === 'entrega' ? 'Entrega' : 'Retirada'}</p>`;
  
  if (tipo === 'entrega') {
    const rua = document.getElementById('rua').value;
    const numero = document.getElementById('numeroCasa').value;
    const bairro = document.getElementById('bairro').value;
    resumo += `<p><strong><img src="entrega.png" alt="Endereço" style="height: 16px; width: 16px; display: inline; vertical-align: middle; margin-right: 4px;"> Endereço:</strong> ${rua}, ${numero}, ${bairro}</p>`;
    resumo += `<p><strong><img src="entrega.png" alt="Taxa" style="height: 16px; width: 16px; display: inline; vertical-align: middle; margin-right: 4px;"> Taxa de Entrega:</strong> R$ 3,00</p>`;
    subtotal += taxaEntrega;
  }
  
  resumo += `<p><strong><img src="cartao.png" alt="Pagamento" style="height: 16px; width: 16px; display: inline; vertical-align: middle; margin-right: 4px;"> Pagamento:</strong> ${pagamento === 'pix' ? 'PIX' : pagamento === 'dinheiro' ? 'Dinheiro' : 'Cartão'}</p>`;
  resumo += `</div>`;
  resumo += `<div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-top: 10px;">`;
  resumo += `<p style="margin: 0; font-size: 18px; font-weight: bold; color: #ff9800;">Total: R$ ${subtotal.toFixed(2)}</p>`;
  resumo += `</div>`;
  
  document.getElementById('resumo-pedido').innerHTML = resumo;
  document.getElementById('modal-confirmacao').style.display = 'flex';
}

function fecharModal() {
  document.getElementById('modal-confirmacao').style.display = 'none';
}

function enviarWhatsApp() {
  const pagamento = document.getElementById('pagamento').value;
  
  if (pagamento === 'pix') {
    fecharModal();
    document.getElementById('modal-pix').style.display = 'flex';
    return;
  }
  
  enviarPedidoWhatsApp();
}

function confirmarPix() {
  fecharModalPix();
  enviarPedidoWhatsApp();
}

function fecharModalPix() {
  document.getElementById('modal-pix').style.display = 'none';
}

function enviarPedidoWhatsApp() {
  let msg = '*PEDIDO PASTELARIA*\n\n';
  
  const nome = document.getElementById('nomeCliente').value;
  msg += `*Cliente:* ${nome}\n\n`;
  
  msg += '*Itens:*\n';
  carrinho.forEach(item => {
    const valor = item.qtd * item.preco;
    msg += `• ${item.nome} (${item.tamanho}) x${item.qtd} - R$ ${valor.toFixed(2)}\n`;
  });
  
  const tipo = document.getElementById('tipoPedido').value;
  const pagamento = document.getElementById('pagamento').value;
  
  msg += `\n*Tipo:* ${tipo === 'entrega' ? 'Entrega' : 'Retirada'}\n`;
  
  if (tipo === 'entrega') {
    const rua = document.getElementById('rua').value;
    const numero = document.getElementById('numeroCasa').value;
    const bairro = document.getElementById('bairro').value;
    msg += `*Endereço:* ${rua}, ${numero}, ${bairro}\n`;
    msg += `*Taxa de Entrega:* R$ 3,00\n`;
  }
  
  let total = carrinho.reduce((sum, item) => sum + (item.qtd * item.preco), 0);
  if (tipo === 'entrega') total += taxaEntrega;
  
  const formaPagamento = pagamento === 'pix' ? 'PIX' : pagamento === 'dinheiro' ? 'Dinheiro' : 'Cartão';
  msg += `\n*Pagamento:* ${formaPagamento}\n`;
  msg += `*Total:* R$ ${total.toFixed(2)}`;
  
  const telefone = '5527999720469';
  const url = `https://wa.me/${telefone}?text=${encodeURIComponent(msg)}`;
  window.open(url, '_blank');
  
  // Limpar dados após envio
  setTimeout(() => {
    carrinho = [];
    atualizarBadgeCarrinho();
    document.getElementById('nomeCliente').value = '';
    document.getElementById('rua').value = '';
    document.getElementById('numeroCasa').value = '';
    document.getElementById('bairro').value = '';
    document.getElementById('tipoPedido').value = 'retirada';
    document.getElementById('pagamento').value = 'pix';
    voltarCategorias();
  }, 500);
}
</script>

</body>
</html>
